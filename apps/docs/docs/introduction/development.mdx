# Development

## Local Development Setup

These instructions will get you a copy of the Drawink monorepo up and running on your local machine for development.

### Requirements

- **[Bun](https://bun.sh)** v1.3.3+ (required - used as package manager and runtime)
- **[Node.js](https://nodejs.org/en/)** v18+ (for compatibility)
- **[Git](https://git-scm.com/downloads)**

### Clone the Repository

```bash
git clone <repository-url>
cd drawink
```

### Install Dependencies

```bash
bun install
```

This will install all dependencies across the entire monorepo using Bun's fast package manager.

### Development Servers

#### Start All Apps (Parallel)

```bash
bun run dev
```

This starts all applications simultaneously:
- **Web App**: http://localhost:5173 (Vite dev server)
- **API Server**: http://localhost:3001 (tRPC + Hono)
- **WebSocket Server**: http://localhost:3003 (Socket.IO)
- **Landing Page**: http://localhost:4321 (Astro)
- **Docs**: http://localhost:3000 (Docusaurus)

#### Start Individual Apps

```bash
# Just the web app
bun run dev --filter=@drawink/web

# Just the API
bun run dev --filter=@drawink/api

# Web + API
bun run dev --filter=@drawink/web --filter=@drawink/api
```

## Common Commands

### Build

Build all packages and applications:

```bash
bun run build
```

Build specific app:

```bash
bun run build --filter=@drawink/web
```

### Lint

Lint all code with Biome:

```bash
bun run lint
```

### Type Check

Run TypeScript type checking:

```bash
bun run typecheck
```

### Test

Run tests with Vitest:

```bash
bun run test
```

### Clean

Clean all build artifacts and node_modules:

```bash
bun run clean
```

## Turborepo Caching

Turborepo caches build outputs to speed up subsequent builds. The cache is stored in `.turbo/` directories.

To clear the cache:

```bash
rm -rf .turbo
bun run clean
```

## Development Workflow

1. **Create a feature branch**
   ```bash
   git checkout -b feature/your-feature-name
   ```

2. **Make your changes**
   - Edit files in the appropriate app or package
   - Test locally with `bun run dev`

3. **Run checks before committing**
   ```bash
   bun run lint
   bun run typecheck
   bun run test
   ```

4. **Commit and push**
   ```bash
   git add .
   git commit -m "feat: your feature description"
   git push origin feature/your-feature-name
   ```

## Monorepo Structure

```
drawink/
├── apps/
│   ├── web/       # Main whiteboard application (Vite + React)
│   ├── api/       # Backend API (tRPC + Hono)
│   ├── ws/        # WebSocket server (Socket.IO)
│   ├── landing/   # Marketing site (Astro)
│   └── docs/      # Documentation (Docusaurus)
│
├── packages/
│   ├── common/    # Shared utilities and constants
│   ├── math/      # 2D math functions
│   ├── element/   # Element logic
│   ├── drawink/   # Core React component
│   ├── types/     # Shared TypeScript types
│   ├── utils/     # Shared utilities
│   ├── ui/        # Shared UI components
│   ├── config/    # Shared configurations
│   └── trpc/      # tRPC router definitions
│
├── turbo.json     # Turborepo configuration
├── package.json   # Root package.json
└── biome.json     # Biome linter configuration
```

## Tech Stack

| Layer | Technology |
|-------|-----------|
| Monorepo | Turborepo |
| Runtime | Bun |
| Web App | Vite + React |
| API | tRPC + Hono |
| WebSocket | Socket.IO |
| Database | Firebase Firestore |
| Auth | Clerk |
| Payments | Stripe |
| State | Jotai |
| Styling | Tailwind CSS |
| UI Components | Radix UI |
| TypeScript | 5.3 |
| Linting | Biome |
| Testing | Vitest |
