# Environment Variables Setup

## Overview

All environment variables are now centralized at the **root level** of the project. Sub-app specific env files have been removed to avoid duplication and confusion.

## File Structure

```
drawink/
â”œâ”€â”€ .env.example              # Template with placeholders (TRACKED)
â”œâ”€â”€ .env.local                # Your secrets (GITIGNORED)
â”œâ”€â”€ .env.development          # Dev-specific config (TRACKED)
â”œâ”€â”€ .env.production           # Prod-specific config (TRACKED)
â””â”€â”€ apps/
    â”œâ”€â”€ web/                  # No .env files here anymore
    â”œâ”€â”€ api/                  # No .env files here anymore
    â””â”€â”€ docs/                 # No .env files here anymore
```

## Environment Loading Priority

Environment variables are loaded in this order (highest priority first):

1. `.env.development.local` or `.env.production.local` (gitignored, environment-specific secrets)
2. `.env.local` (gitignored, your personal secrets)
3. `.env.development` or `.env.production` (tracked, no secrets)
4. `.env.example` (tracked, template only)

## Setup Instructions

### For New Developers

1. Clone the repository
2. Copy the template to create your local secrets file:
   ```bash
   cp .env.example .env.local
   ```
3. Fill in your actual API keys and secrets in `.env.local`
4. Never commit `.env.local` - it's already gitignored

### For Existing Developers

Your existing `.env.local` file has been updated with all variables. No action needed.

## Variable Categories

### ðŸ” Secrets (in .env.local only)
- `CLERK_SECRET_KEY` - Clerk authentication secret
- `FIREBASE_PRIVATE_KEY` - Firebase Admin SDK private key
- `STRIPE_SECRET_KEY` - Stripe secret key
- `STRIPE_WEBHOOK_SECRET` - Stripe webhook signing secret

### ðŸŒ Public Variables (safe to expose to frontend)
- `VITE_CLERK_PUBLISHABLE_KEY` - Clerk public key
- `VITE_APP_FIREBASE_CONFIG` - Firebase config (all values are public)
- `STRIPE_PUBLISHABLE_KEY` - Stripe public key

### âš™ï¸ Configuration (environment-specific)
- `PORT` - Backend server port
- `VITE_API_URL` - API endpoint URL
- `NODE_ENV` - Environment mode (development/production)

## How Vite Loads Environment Variables

Vite automatically loads environment variables from the root directory:

1. **Frontend (Vite apps)**: Only variables prefixed with `VITE_` are exposed to the browser
2. **Backend (Node apps)**: All variables are available via `process.env`
3. **Shared**: Both frontend and backend read from the same root `.env` files

## Security Best Practices

### âœ… DO
- Keep secrets in `.env.local` (gitignored)
- Use placeholders in `.env.example` (tracked)
- Prefix frontend variables with `VITE_`
- Document all new variables in `.env.example`

### âŒ DON'T
- Commit `.env.local` to git
- Put secrets in `.env.development` or `.env.production`
- Share your `.env.local` file with others
- Hardcode secrets in source code

## Variable Reference

### Clerk Authentication
```bash
# Get from: https://dashboard.clerk.com
VITE_CLERK_PUBLISHABLE_KEY=pk_test_...  # Frontend (public)
CLERK_SECRET_KEY=sk_test_...            # Backend (secret)
```

### Firebase Configuration
```bash
# Get from: Firebase Console > Project Settings > Web app
VITE_APP_FIREBASE_CONFIG='{"apiKey":"...","authDomain":"...","projectId":"..."}'

# Firebase Admin SDK (Backend only)
# Get from: Firebase Console > Project Settings > Service Accounts
FIREBASE_PROJECT_ID=your-project-id
FIREBASE_CLIENT_EMAIL=firebase-adminsdk@...
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
```

### Stripe Billing
```bash
# Get from: https://dashboard.stripe.com/test/apikeys
STRIPE_SECRET_KEY=sk_test_...              # Backend (secret)
STRIPE_PUBLISHABLE_KEY=pk_test_...         # Frontend (public)
STRIPE_WEBHOOK_SECRET=whsec_...            # Webhook endpoint (secret)

# Get from: Stripe Dashboard > Products
STRIPE_PRICE_ID_PRO=price_...              # Pro tier price ID
STRIPE_PRICE_ID_TEAM=price_...             # Team tier price ID
```

### API Configuration
```bash
# Development
VITE_API_URL=http://localhost:3001
VITE_WS_URL=ws://localhost:3003

# Production
VITE_API_URL=https://api.drawink.app
VITE_WS_URL=wss://ws.drawink.app
```

## Troubleshooting

### "Environment variable not found"
1. Check that the variable exists in `.env.local`
2. Restart your dev server (Vite doesn't hot-reload env changes)
3. Check that frontend variables are prefixed with `VITE_`

### "CORS error when calling API"
1. Check that `ALLOWED_ORIGINS` includes your frontend URL
2. Make sure `VITE_API_URL` points to the correct backend URL

### "Stripe webhook signature verification failed"
1. Check that `STRIPE_WEBHOOK_SECRET` matches your Stripe dashboard
2. Use Stripe CLI for local testing: `stripe listen --forward-to localhost:3001/webhooks/stripe`

## Migration from Old Setup

If you had env files in `apps/web/` or `apps/api/`, they have been consolidated into the root `.env.local` file. All values have been preserved.

### Changes Made
- âœ… Consolidated all variables into root `.env.example` and `.env.local`
- âœ… Removed `apps/web/.env.local`, `apps/web/.env.example`
- âœ… Removed `apps/api/.env.example`
- âœ… Removed `apps/docs/.env`
- âœ… All values preserved in root `.env.local`

## Need Help?

If you're missing environment variables or having issues:

1. Check this README for the variable you need
2. Copy the template from `.env.example`
3. Get the actual values from the appropriate service dashboard
4. Add them to your `.env.local` file
5. Restart your dev server

## Related Documentation

- [Phase 4 Completion](./docs/migration/PHASE_4_COMPLETION.md) - Stripe billing setup
- [Stripe Setup Guide](https://stripe.com/docs/keys) - Getting your API keys
- [Clerk Setup Guide](https://clerk.com/docs/quickstarts/setup-clerk) - Authentication setup
- [Firebase Setup](https://firebase.google.com/docs/web/setup) - Firebase configuration
