# Docker Compose for Drawink Development
# Run with: docker-compose up

services:
  # Production-like build (all services in one container)
  drawink:
    build:
      context: .
      args:
        - NODE_ENV=production
    container_name: drawink
    ports:
      - "3000:3000" # Frontend (nginx)
    restart: on-failure
    healthcheck:
      test: [ "CMD", "wget", "-q", "-O", "/dev/null", "http://localhost:3000/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
    environment:
      - NODE_ENV=production
  # Development mode: Run services separately for hot reload
  # Uncomment below and comment out 'drawink' service above for development

  # frontend:
  #   image: oven/bun:1
  #   container_name: drawink-frontend
  #   working_dir: /app
  #   command: sh -c "bun install && cd drawink-app && bun run start"
  #   ports:
  #     - "5173:5173"
  #   volumes:
  #     - .:/app
  #     - node_modules:/app/node_modules
  #   environment:
  #     - VITE_APP_BACKEND_V2_GET_URL=http://localhost:3001/api/v2/
  #     - VITE_APP_BACKEND_V2_POST_URL=http://localhost:3001/api/v2/post

  # json-server:
  #   image: oven/bun:1
  #   container_name: drawink-json-server
  #   working_dir: /app/json-server
  #   command: sh -c "bun install && bun run dev"
  #   ports:
  #     - "3001:3001"
  #   volumes:
  #     - ./json-server:/app/json-server
  #   environment:
  #     - PORT=3001

  # websocket-server:
  #   image: oven/bun:1
  #   container_name: drawink-websocket-server
  #   working_dir: /app/websocket-server
  #   command: sh -c "bun install && bun run dev"
  #   ports:
  #     - "3003:3003"
  #   volumes:
  #     - ./websocket-server:/app/websocket-server
  #   environment:
  #     - PORT=3003

volumes:
  node_modules:
